{% extends 'Dashboards/Layout/athlete_base.html' %}
{% load static %}
{% load math_filters %}

{% block title %}{{ assessment.title }} | Mental Assessment{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
{% endblock %}

{% block content %}
<div class="relative overflow-hidden bg-gradient-to-b from-indigo-50 to-white">
    <!-- 3D Brain Visualization Background (will be initialized via JS) -->
    <div id="brain-visualization" class="absolute inset-0 opacity-10 pointer-events-none"></div>

    <!-- Floating Particles Background -->
    <div id="particles-js" class="absolute inset-0 pointer-events-none"></div>
    
    <div class="container mx-auto px-4 py-12 relative z-10">
        <div class="max-w-4xl mx-auto">
            <!-- Back Button -->
         

            <!-- Assessment Card -->
            <div data-aos="fade-up" data-aos-duration="800" class="bg-white rounded-2xl shadow-xl overflow-hidden mb-8 transform transition-all hover:shadow-2xl">
                <div class="relative h-32 bg-gradient-to-r from-indigo-500 to-purple-600">
                    <!-- 3D Floating Assessment Icons -->
                    <div class="assessment-icons absolute inset-0 overflow-hidden opacity-30">
                        <div class="floating-icon" style="top: 20%; left: 10%;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <div class="floating-icon" style="top: 50%; left: 25%;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                        </div>
                        <div class="floating-icon" style="top: 30%; left: 70%;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                    </div>

                    <!-- Category Badge -->
                    <div class="absolute top-4 right-4">
                        <span class="px-3 py-1 text-xs font-bold rounded-full bg-white bg-opacity-30 text-white backdrop-filter backdrop-blur-sm">
                            {{ assessment.category.name|default:"General Assessment" }}
                        </span>
                    </div>
                </div>

                <div class="p-6">
                    <div class="flex items-center flex-wrap gap-3 mb-4">
                        <h1 class="text-3xl font-bold text-gray-800 mr-3">{{ assessment.title }}</h1>
                        <span class="px-3 py-1 text-xs font-semibold rounded-full 
                            {% if assessment.difficulty_level == 'basic' %}bg-green-100 text-green-800
                            {% elif assessment.difficulty_level == 'intermediate' %}bg-blue-100 text-blue-800
                            {% else %}bg-purple-100 text-purple-800{% endif %}">
                            {{ assessment.get_difficulty_level_display }}
                        </span>
                        
                        {% if assessment.is_public %}
                            <span class="px-3 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">Public</span>
                        {% endif %}
                        
                        {% if assignment %}
                            <span class="px-3 py-1 text-xs font-semibold rounded-full bg-amber-100 text-amber-800">Assigned</span>
                        {% endif %}
                    </div>
                    
                    <p class="text-gray-600 mb-6">{{ assessment.description }}</p>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div data-aos="zoom-in" data-aos-delay="100" class="flex flex-col items-center justify-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <div class="flex items-center justify-center w-12 h-12 mb-3 rounded-full bg-indigo-100 text-indigo-600">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <span class="text-sm font-medium text-gray-500">Duration</span>
                            <span class="text-lg font-bold text-gray-800">{{ assessment.estimated_time_minutes }} min</span>
                        </div>
                        
                        <div data-aos="zoom-in" data-aos-delay="200" class="flex flex-col items-center justify-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <div class="flex items-center justify-center w-12 h-12 mb-3 rounded-full bg-purple-100 text-purple-600">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                                </svg>
                            </div>
                            <span class="text-sm font-medium text-gray-500">Questions</span>
                            <span class="text-lg font-bold text-gray-800">{{ assessment.questions.count }}</span>
                        </div>
                        
                        <div data-aos="zoom-in" data-aos-delay="300" class="flex flex-col items-center justify-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <div class="flex items-center justify-center w-12 h-12 mb-3 rounded-full bg-blue-100 text-blue-600">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <span class="text-sm font-medium text-gray-500">Results</span>
                            <span class="text-lg font-bold text-gray-800">
                                {% if assessment.show_results_immediately %}
                                Immediate
                                {% else %}
                                After Review
                                {% endif %}
                            </span>
                        </div>
                        
                        <div data-aos="zoom-in" data-aos-delay="400" class="flex flex-col items-center justify-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <div class="flex items-center justify-center w-12 h-12 mb-3 rounded-full bg-green-100 text-green-600">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
                                </svg>
                            </div>
                            <span class="text-sm font-medium text-gray-500">Retake</span>
                            <span class="text-lg font-bold text-gray-800">
                                {% if assessment.allow_retake %}
                                    {% if assessment.minimum_days_between_retakes > 0 %}
                                        {{ assessment.minimum_days_between_retakes }} days
                                    {% else %}
                                        Anytime
                                    {% endif %}
                                {% else %}
                                    No
                                {% endif %}
                            </span>
                        </div>
                    </div>
                    
                    {% if assignment and assignment.due_date %}
                    <div class="mb-6 animate-pulse-slow">
                        <div class="flex items-center p-4 rounded-lg bg-amber-50 border border-amber-200">
                            <div class="flex-shrink-0 mr-3">
                                <div class="w-12 h-12 rounded-lg bg-amber-500 flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold text-amber-800">Assignment Due Date</h4>
                                <p class="text-amber-700">
                                    {% now "Y-m-d" as today %}
                                    {% if assignment.due_date|date:"Y-m-d" < today %}
                                        <span class="text-red-600 font-bold">Overdue!</span> Was due on {{ assignment.due_date|date:"l, F j, Y" }}
                                    {% else %}
                                        Due on {{ assignment.due_date|date:"l, F j, Y" }} 
                                        ({% if assignment.due_date|timeuntil == "0 minutes" %}Today{% else %}{{ assignment.due_date|timeuntil }} remaining{% endif %})
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Assessment Actions Card -->
            <div data-aos="fade-up" data-aos-delay="200" class="bg-white rounded-2xl shadow-xl overflow-hidden mb-8">
                <div class="p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                        </svg>
                        Take Assessment
                    </h2>

                    {% if in_progress_response %}
                        <div class="mb-6 border-2 border-dashed border-indigo-300 rounded-xl p-6 bg-indigo-50">
                            <div class="flex flex-col md:flex-row md:items-center">
                                <div class="flex-grow mb-4 md:mb-0">
                                    <h3 class="text-xl font-semibold text-indigo-800 mb-2">Continue Your Assessment</h3>
                                    <p class="text-indigo-700">
                                        You started this assessment on {{ in_progress_response.started_at|date:"F j, Y" }} at {{ in_progress_response.started_at|time:"g:i A" }}.
                                        Your progress has been saved.
                                    </p>
                                </div>
                                <div class="flex-shrink-0">
                                    <a href="{% url 'continue_assessment' in_progress_response.id %}" 
                                       class="flex items-center justify-center px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transform hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-xl">
                                        <span class="mr-2">Continue Assessment</span>
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                                        </svg>
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        {% if not assessment.allow_retake and previous_responses.exists %}
                            <div class="mb-6 border-2 border-dashed border-red-300 rounded-xl p-6 bg-red-50">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0 mr-4">
                                        <div class="w-12 h-12 rounded-full bg-red-100 flex items-center justify-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                            </svg>
                                        </div>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-semibold text-red-800 mb-1">Cannot Retake This Assessment</h3>
                                        <p class="text-red-700">
                                            You completed this assessment on {{ previous_responses.first.completed_at|date:"F j, Y" }}.
                                            This assessment is configured to be taken only once.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        {% elif assessment.minimum_days_between_retakes > 0 and previous_responses.exists %}
                            {% now "Y-m-d" as today %}
                            {% with last_response=previous_responses.first %}
                                {% with days_since=last_response.completed_at|timesince:today|cut:" days" %}
                                    {% if days_since < assessment.minimum_days_between_retakes %}
                                        <div class="mb-6 border-2 border-dashed border-amber-300 rounded-xl p-6 bg-amber-50">
                                            <div class="flex items-center">
                                                <div class="flex-shrink-0 mr-4">
                                                    <div class="w-12 h-12 rounded-full bg-amber-100 flex items-center justify-center">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-amber-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                        </svg>
                                                    </div>
                                                </div>
                                                <div>
                                                    <h3 class="text-xl font-semibold text-amber-800 mb-1">Waiting Period Required</h3>
                                                    <p class="text-amber-700">
                                                        {% with days_since=last_response.completed_at|timesince:today|cut:" days" %}
    {% if days_since < assessment.minimum_days_between_retakes %}
        You can take it again in {{ assessment.minimum_days_between_retakes|sub:days_since }} days.
    {% endif %}
{% endwith %}
                                                        You can take it again in {{ assessment.minimum_days_between_retakes|sub:days_since }} days.
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    {% else %}
                                        <div class="mb-6">
                                            <h3 class="text-xl font-semibold text-gray-800 mb-3">Ready to Begin</h3>
                                            <p class="text-gray-600 mb-4">
                                                This assessment will help evaluate your current mental state and provide valuable insights.
                                                Your responses will be kept confidential and will help your support team understand how to best assist you.
                                            </p>
                                            
                                            <a href="{% url 'start_assessment' assessment.id %}" 
                                               class="inline-flex items-center px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transform hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-xl">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                                                </svg>
                                                Start Assessment
                                            </a>
                                        </div>
                                    {% endif %}
                                {% endwith %}
                            {% endwith %}
                        {% else %}
                            <div class="mb-6">
                                <h3 class="text-xl font-semibold text-gray-800 mb-3">Ready to Begin</h3>
                                <p class="text-gray-600 mb-4">
                                    This assessment will help evaluate your current mental state and provide valuable insights.
                                    Your responses will be kept confidential and will help your support team understand how to best assist you.
                                </p>
                                
                                <div class="flex flex-col sm:flex-row gap-4 items-center">
                                    <a href="{% url 'start_assessment' assessment.id %}" 
                                       class="w-full sm:w-auto inline-flex items-center justify-center px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transform hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-xl">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                                        </svg>
                                        Start Assessment
                                    </a>
                                    
                                    <button id="show-prep-tips" type="button" 
                                            class="w-full sm:w-auto inline-flex items-center justify-center px-6 py-3 bg-white border border-indigo-200 text-indigo-600 rounded-lg hover:bg-indigo-50 transition-all duration-300">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                        Preparation Tips
                                    </button>
                                </div>
                            </div>
                        {% endif %}
                    {% endif %}

                    <!-- Preparation Tips Dialog -->
                    <div id="prep-tips-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                        <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto" data-aos="zoom-in" data-aos-duration="300">
                            <div class="p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-2xl font-bold text-gray-800">Tips for Best Results</h3>
                                    <button id="close-prep-tips" class="text-gray-400 hover:text-gray-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                
                                <div class="space-y-4">
                                    <div class="flex">
                                        <div class="flex-shrink-0 mr-3">
                                            <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
                                                <span class="text-blue-600 font-bold">1</span>
                                            </div>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold text-gray-800">Find a Quiet Space</h4>
                                            <p class="text-gray-600">Choose a distraction-free environment where you can focus completely on the assessment.</p>
                                        </div>
                                    </div>
                                    
                                    <div class="flex">
                                        <div class="flex-shrink-0 mr-3">
                                            <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
                                                <span class="text-blue-600 font-bold">2</span>
                                            </div>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold text-gray-800">Be Honest</h4>
                                            <p class="text-gray-600">Answer truthfully about your feelings and experiences for the most accurate results.</p>
                                        </div>
                                    </div>
                                    
                                    <div class="flex">
                                        <div class="flex-shrink-0 mr-3">
                                            <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
                                                <span class="text-blue-600 font-bold">3</span>
                                            </div>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold text-gray-800">Take Your Time</h4>
                                            <p class="text-gray-600">Don't rush through questions. Read each one carefully and consider your response.</p>
                                        </div>
                                    </div>
                                    
                                    <div class="flex">
                                        <div class="flex-shrink-0 mr-3">
                                            <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
                                                <span class="text-blue-600 font-bold">4</span>
                                            </div>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold text-gray-800">Complete in One Session</h4>
                                            <p class="text-gray-600">While you can pause if needed, it's best to complete the assessment in one sitting when possible.</p>
                                        </div>
                                    </div>
                                    
                                    <div class="flex">
                                        <div class="flex-shrink-0 mr-3">
                                            <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
                                                <span class="text-blue-600 font-bold">5</span>
                                            </div>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold text-gray-800">Consider Recent Experiences</h4>
                                            <p class="text-gray-600">Most questions relate to your experiences in the past 2-4 weeks unless otherwise specified.</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-6">
                                    <button id="start-from-tips" class="w-full inline-flex items-center justify-center px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-all duration-300">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                                        </svg>
                                        I'm Ready to Start
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    {% if previous_responses %}
                    <div class="mt-8">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Previous Attempts
                        </h3>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Score</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    {% for response in previous_responses %}
                                    <tr class="hover:bg-gray-50 transition-colors">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            {{ response.completed_at|date:"M j, Y" }}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            {% if response.status == 'completed' %}
                                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">Completed</span>
                                            {% else %}
                                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">In Progress</span>
                                            {% endif %}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            {% if response.score %}
                                                {{ response.score }}/{{ assessment.max_score }}
                                            {% else %}
                                                -
                                            {% endif %}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            {% if response.status == 'completed' %}
                                                <a href="{% url 'view_results' response.id %}" class="text-indigo-600 hover:text-indigo-900 mr-3">View Results</a>
                                            {% else %}
                                                <a href="{% url 'continue_assessment' response.id %}" class="text-indigo-600 hover:text-indigo-900 mr-3">Continue</a>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- FAQ Section -->
        <div data-aos="fade-up" data-aos-delay="300" class="bg-white rounded-2xl shadow-xl overflow-hidden mb-8">
            <div class="p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Frequently Asked Questions
                </h2>
                
                <div class="space-y-4">
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <button class="faq-question w-full flex justify-between items-center p-4 bg-gray-50 hover:bg-gray-100 transition-colors">
                            <span class="font-medium text-gray-800">How is my privacy protected?</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <div class="faq-answer hidden p-4 text-gray-600">
                            <p>All assessment responses are encrypted and stored securely. Only authorized personnel in your support network (coaches, medical staff) can view your results, and only in aggregated form unless you explicitly share individual results.</p>
                        </div>
                    </div>
                    
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <button class="faq-question w-full flex justify-between items-center p-4 bg-gray-50 hover:bg-gray-100 transition-colors">
                            <span class="font-medium text-gray-800">What happens if I don't complete the assessment?</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <div class="faq-answer hidden p-4 text-gray-600">
                            <p>Your progress is saved automatically. You can return later to complete the assessment from where you left off. For assigned assessments, your coach or medical staff will be notified if you don't complete it by the due date.</p>
                        </div>
                    </div>
                    
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <button class="faq-question w-full flex justify-between items-center p-4 bg-gray-50 hover:bg-gray-100 transition-colors">
                            <span class="font-medium text-gray-800">How should I interpret my results?</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <div class="faq-answer hidden p-4 text-gray-600">
                            <p>Assessment results provide a snapshot of your current mental state. They are not diagnostic but can help identify areas that may need attention. Your support team will review results with you and discuss any recommended next steps.</p>
                        </div>
                    </div>
                    
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <button class="faq-question w-full flex justify-between items-center p-4 bg-gray-50 hover:bg-gray-100 transition-colors">
                            <span class="font-medium text-gray-800">What if I need immediate help?</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <div class="faq-answer hidden p-4 text-gray-600">
                            <p>If you're experiencing a mental health crisis, please contact your team medical staff immediately or call your local emergency number. This assessment is not designed for crisis situations.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>

<script>
// Initialize AOS animations
document.addEventListener('DOMContentLoaded', function() {
AOS.init({
    duration: 800,
    once: true,
    easing: 'ease-in-out-quad'
});

// FAQ accordion functionality
document.querySelectorAll('.faq-question').forEach(button => {
    button.addEventListener('click', () => {
        const answer = button.nextElementSibling;
        const icon = button.querySelector('svg');
        
        // Toggle answer visibility
        answer.classList.toggle('hidden');
        
        // Rotate icon
        icon.classList.toggle('rotate-180');
        
        // Close other open FAQs
        document.querySelectorAll('.faq-question').forEach(otherButton => {
            if (otherButton !== button) {
                otherButton.nextElementSibling.classList.add('hidden');
                otherButton.querySelector('svg').classList.remove('rotate-180');
            }
        });
    });
});

// Preparation tips modal
const showPrepTips = document.getElementById('show-prep-tips');
const prepTipsModal = document.getElementById('prep-tips-modal');
const closePrepTips = document.getElementById('close-prep-tips');
const startFromTips = document.getElementById('start-from-tips');

showPrepTips.addEventListener('click', () => {
    prepTipsModal.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
});

closePrepTips.addEventListener('click', () => {
    prepTipsModal.classList.add('hidden');
    document.body.style.overflow = '';
});

startFromTips.addEventListener('click', () => {
    window.location.href = "{% url 'start_assessment' assessment.id %}";
});

// Close modal when clicking outside
prepTipsModal.addEventListener('click', (e) => {
    if (e.target === prepTipsModal) {
        prepTipsModal.classList.add('hidden');
        document.body.style.overflow = '';
    }
});

// Floating icons animation
gsap.to(".floating-icon", {
    y: 10,
    duration: 3,
    repeat: -1,
    yoyo: true,
    ease: "sine.inOut",
    stagger: 0.5
});

// 3D Brain Visualization
const brainContainer = document.getElementById('brain-visualization');
if (brainContainer) {
    // Set up Three.js scene
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, brainContainer.clientWidth / brainContainer.clientHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
    renderer.setSize(brainContainer.clientWidth, brainContainer.clientHeight);
    brainContainer.appendChild(renderer.domElement);

    // Add lighting
    const ambientLight = new THREE.AmbientLight(0x404040);
    scene.add(ambientLight);
    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
    directionalLight.position.set(1, 1, 1);
    scene.add(directionalLight);

    // Load brain model (simplified for example)
    const geometry = new THREE.SphereGeometry(5, 32, 32);
    const material = new THREE.MeshPhongMaterial({ 
        color: 0x3b82f6,
        transparent: true,
        opacity: 0.3,
        wireframe: true
    });
    const brain = new THREE.Mesh(geometry, material);
    scene.add(brain);

    camera.position.z = 10;

    // Animation loop
    function animate() {
        requestAnimationFrame(animate);
        brain.rotation.x += 0.002;
        brain.rotation.y += 0.003;
        renderer.render(scene, camera);
    }
    animate();

    // Handle window resize
    window.addEventListener('resize', () => {
        camera.aspect = brainContainer.clientWidth / brainContainer.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(brainContainer.clientWidth, brainContainer.clientHeight);
    });
}

// Particles.js configuration
if (document.getElementById('particles-js')) {
    particlesJS('particles-js', {
        particles: {
            number: { value: 60, density: { enable: true, value_area: 800 } },
            color: { value: "#3b82f6" },
            shape: { type: "circle" },
            opacity: { value: 0.3, random: true },
            size: { value: 3, random: true },
            line_linked: { enable: false },
            move: {
                enable: true,
                speed: 1,
                direction: "none",
                random: true,
                straight: false,
                out_mode: "out",
                bounce: false
            }
        },
        interactivity: {
            detect_on: "canvas",
            events: {
                onhover: { enable: false },
                onclick: { enable: false },
                resize: true
            }
        }
    });
}
});
</script>

{% endblock %}